<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Cody's Coming Soon Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <div class="hero">
        <section class="logo-container">
            <img src="./images/c-charmmm-clear.png" alt="Logo" class="logo">
        </section>
        <section class="content">
            <form class="notify-form" onsubmit="handleSubmit(event)">
                <input type="email" class="notify-input" placeholder="Enter your email" required
                    aria-label="Email address" />
                <button type="submit" class="notify-button">Notify Me</button>
            </form>
            <p class="message" id="message"></p>
            <img src="./images/cody-logo.png" alt="Cody coming soon" class="cody-img">
        </section>
    </div>
    <script>
        async function handleSubmit(event) {
            event.preventDefault();

            const email = event.target.querySelector('input').value;
            const button = event.target.querySelector('button');
            const messageEl = document.getElementById('message');

            // Disable button and show loading state
            button.disabled = true;
            button.textContent = 'Submitting...';
            messageEl.textContent = '';

            try {
                const response = await fetch('https://empire-api.afam.app/api/v1/cody/newsletter-signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email: email })
                });

                const data = await response.json();

                if (response.ok) {
                    messageEl.textContent = 'ðŸš€ Thanks! We\'ll notify you when we launch!';
                    messageEl.style.color = '#4ade80'; // green
                    event.target.reset();
                } else {
                    messageEl.textContent = data.error || 'Something went wrong. Please try again.';
                    messageEl.style.color = '#ef4444'; // red
                }
            } catch (error) {
                console.error('Error:', error);
                messageEl.textContent = 'Network error. Please try again.';
                messageEl.style.color = '#ef4444'; // red
            } finally {
                // Re-enable button
                button.disabled = false;
                button.textContent = 'Notify Me';
            }
        }
    </script>
</body>

</html>